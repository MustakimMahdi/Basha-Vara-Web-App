<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶¨‡¶æ‡¶∏‡¶æ ‡¶≠‡¶æ‡¶°‡¶º‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</title>
    <meta name="description" content="‡¶¨‡¶æ‡¶∏‡¶æ ‡¶≠‡¶æ‡¶°‡¶º‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ - ‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ‡¶¶‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶® ‡¶∏‡¶π‡¶ú‡ßá‡¶á">
    <meta name="theme-color" content="#4f46e5">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoi4Kas4Ka+4Ka44Ka+IOCmreCmvuCmoeCmvyDgpqzgp43gpq/gprXgprjgp43gpqXgpr7gpqrgpqjgpr4iLCJzaG9ydF9uYW1lIjoi4Kas4Ka+4Ka44Ka+IOCmreCmvuCmoeCmvyIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZmZmZmZmIiwidGhlbWVfY29sb3IiOiIjNGY0NmU1IiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1USTRJaUJvWldsbmFIUTlJakV5T0NJZ2RtbGxkMEp2ZUQwaU1DQXdJREV5T0NBeU9EZ2lJR1pwYkd3OUltNXZibVVpSUhOMGNtOXJaVDBpWTNWeWNtVnVkRU52Ykc5eUlpQjJhV1YzUW05NFBTSXdJREFnTWpRZ01qUWlQaUE4Y0dGMGFDQnpkSEp2YTJVdGJHbHVaV05oY0QwaWNtOTFibVFpSUhOMGNtOXJaUzFzYVc1bGFtOXBiajFpY205MWJtUWlJSE4wY205clpTMTNhV1IwYUQwaU1pSWdaRDBpVFRFM0lESXdhRFZXTldFeU15QXpJREF3TFRVdU16VTJMVEV1T0RVM1RURTNJREl3U0RkdE1UQWdNR1l0TW1NdExqWTFOaTR4TWpZdE1TNHlPRE10TXpVMkxURTROVGROU0RjZ01qQklNbll0TW1FeklEQWdNREExTGpNMU5pMHhMamcxTjIwdE1TNHpOVGNnTUdFMUxqQXdNaUExTGpBd01pQXdJREE1TGpJNE9DQXdUVEUxSURkaE15QXpJREV4TFRZZ01DQXpJRFlnTUNBMklEQjZiVFlnTTJFeUlESWdNVEV0TkNBd0lEQWdNaTB6SURBdE5DQXdlbTAwSURFd1lUSWdNaUF4TVMwMElEQWdNQ0EwSURBZ01pQXpJREF3SWlBdlBpQThMM04yWnowOCIsInNpemVzIjoiMTI4eDEyOCIsInR5cGUiOiJpbWFnZS9zdmcreG1sIn1dfQ==">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAyODgiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiB2aWV3Qm94PSIwIDAgMjQgMjQiPiA8cGF0aCBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTE3IDIwaDVWNWEyIDMgMCAwMC01LjM1Ni0xLjg1N00xNyAyMEg3bTEwIDAtMmMwLS42NTYuMTI2LTEuMjgzLjM1Ni0xLjg1N003IDIwSDJ2LTJhMyAzIDAgMDE1LjM1Ni0xLjg1N003IDIwdi0yYzAtLjY1Ni4xMjYtMS4yODMuMzU2LTEuODU3bTAgMGE1LjAwMiA1LjAwMiAwIDAxOS4yODggME0xNSA3YTMgMyAwIDExLTYgMCAzIDMgMCAwMTYgMHptNiAzYTIgMiAwIDExLTQgMCAyIDIgMCAwMTQgMHpNNyAxMGEyIDIgMCAxMS00IDAgMiAyIDAgMDE0IDB6Ii8+PC9zdmc+">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .balance-positive { color: #059669; }
        .balance-negative { color: #dc2626; }
        .balance-zero { color: #6b7280; }
        .month-paid { background-color: #dcfce7; color: #166534; }
        .month-unpaid { background-color: #fef2f2; color: #991b1b; }
        .month-partial { background-color: #fef3c7; color: #92400e; }
        
        /* Mobile App Optimizations */
        @media (max-width: 768px) {
            .mobile-optimized {
                padding: 1rem;
                font-size: 16px; /* Prevents zoom on iOS */
            }
            
            .touch-friendly {
                min-height: 44px;
                min-width: 44px;
            }
            
            .mobile-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }
        
        /* PWA Splash Screen */
        @media (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
            
            .pwa-header {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
            }
        }
        
        /* Offline indicator */
        .offline-indicator {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #f59e0b;
            color: white;
            text-align: center;
            padding: 0.5rem;
            z-index: 1000;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }
        
        .offline-indicator.show {
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Offline Indicator -->
    <div id="offlineIndicator" class="offline-indicator">
        üì° ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á - ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶Æ‡ßã‡¶°‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶õ‡ßá
    </div>
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-indigo-500 pwa-header">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4 md:py-6">
                <div class="flex items-center">
                    <div class="bg-indigo-500 p-2 md:p-3 rounded-lg mr-3 md:mr-4">
                        <svg class="w-6 h-6 md:w-8 md:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                    </div>
                    <h1 class="text-xl md:text-3xl font-bold text-gray-900">‡¶¨‡¶æ‡¶∏‡¶æ ‡¶≠‡¶æ‡¶°‡¶º‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</h1>
                </div>
                <div class="flex space-x-2 md:space-x-3">
                    <button id="installBtn" class="bg-green-600 hover:bg-green-700 text-white px-3 md:px-4 py-2 rounded-lg font-semibold transition-colors duration-200 shadow-md hidden touch-friendly text-sm md:text-base">
                        üì± <span class="hidden sm:inline">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</span><span class="sm:hidden">‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶≤</span>
                    </button>
                    <button id="addTenantBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 md:px-6 py-2 md:py-3 rounded-lg font-semibold transition-colors duration-200 shadow-md touch-friendly text-sm md:text-base">
                        + <span class="hidden sm:inline">‡¶®‡¶§‡ßÅ‡¶® ‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ</span><span class="sm:hidden">‡¶®‡¶§‡ßÅ‡¶®</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Dashboard Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-6 mb-6 md:mb-8">
            <div class="bg-white rounded-xl shadow-md p-3 md:p-6 border-l-4 border-green-500">
                <div class="flex items-center">
                    <div class="bg-green-100 p-2 md:p-3 rounded-full mr-2 md:mr-4">
                        <svg class="w-4 h-4 md:w-6 md:h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="text-xs md:text-sm font-medium text-gray-600">‡¶Æ‡ßã‡¶ü ‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ</p>
                        <p id="totalTenants" class="text-lg md:text-2xl font-bold text-gray-900">‡ß¶</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-3 md:p-6 border-l-4 border-blue-500">
                <div class="flex items-center">
                    <div class="bg-blue-100 p-2 md:p-3 rounded-full mr-2 md:mr-4">
                        <svg class="w-4 h-4 md:w-6 md:h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="text-xs md:text-sm font-medium text-gray-600">‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶Ü‡¶Ø‡¶º</p>
                        <p id="monthlyRevenue" class="text-lg md:text-2xl font-bold text-gray-900">‡ß≥‡ß¶</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-3 md:p-6 border-l-4 border-yellow-500">
                <div class="flex items-center">
                    <div class="bg-yellow-100 p-2 md:p-3 rounded-full mr-2 md:mr-4">
                        <svg class="w-4 h-4 md:w-6 md:h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="text-xs md:text-sm font-medium text-gray-600">‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ</p>
                        <p id="outstandingAmount" class="text-lg md:text-2xl font-bold text-gray-900">‡ß≥‡ß¶</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-md p-3 md:p-6 border-l-4 border-purple-500">
                <div class="flex items-center">
                    <div class="bg-purple-100 p-2 md:p-3 rounded-full mr-2 md:mr-4">
                        <svg class="w-4 h-4 md:w-6 md:h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="text-xs md:text-sm font-medium text-gray-600">‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏‡ßá ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß</p>
                        <p id="currentMonthPaid" class="text-lg md:text-2xl font-bold text-gray-900">‡ß¶</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Outstanding Amounts Section -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-gray-900">üî¥ ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h2>
                <div class="flex space-x-2">
                    <button id="refreshOutstanding" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm">
                        üîÑ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂
                    </button>
                    <select id="outstandingFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm">
                        <option value="all">‡¶∏‡¶¨ ‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ</option>
                        <option value="outstanding">‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ</option>
                        <option value="advance">‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ</option>
                    </select>
                </div>
            </div>
            <div id="outstandingList" class="space-y-3">
                <!-- Outstanding list will be loaded here -->
            </div>
        </div>

        <!-- Current Month Status -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-gray-900">‡¶ö‡¶≤‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</h2>
                <select id="monthFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                    <option value="">‡¶∏‡¶¨ ‡¶Æ‡¶æ‡¶∏</option>
                </select>
            </div>
            <div id="monthlyStatus" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Monthly status will be loaded here -->
            </div>
        </div>

        <!-- Tenants List -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
                <h2 class="text-xl font-semibold text-gray-900">‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h2>
            </div>
            <div id="tenantsContainer" class="divide-y divide-gray-200">
                <!-- Tenants will be loaded here -->
            </div>
        </div>
    </main>

    <!-- Add Tenant Modal -->
    <div id="addTenantModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full mx-4 fade-in">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">‡¶®‡¶§‡ßÅ‡¶® ‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            </div>
            <form id="addTenantForm" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶æ‡¶Æ</label>
                    <input type="text" id="tenantName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
                    <input type="tel" id="tenantPhone" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡¶∞‡ßÅ‡¶Æ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
                    <input type="text" id="tenantRoom" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶≠‡¶æ‡¶°‡¶º‡¶æ (‡ß≥)</label>
                    <input type="number" id="tenantRent" required min="0" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ ‡¶ü‡¶æ‡¶ï‡¶æ (‡ß≥)</label>
                    <input type="number" id="tenantAdvance" min="0" step="0.01" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡¶≠‡¶æ‡¶°‡¶º‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶Æ‡¶æ‡¶∏</label>
                    <select id="tenantStartMonth" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="">‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                        <option value="2024-01">‡¶ú‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø ‡ß®‡ß¶‡ß®‡ß™</option>
                        <option value="2024-02">‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø ‡ß®‡ß¶‡ß®‡ß™</option>
                        <option value="2024-03">‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö ‡ß®‡ß¶‡ß®‡ß™</option>
                        <option value="2024-04">‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤ ‡ß®‡ß¶‡ß®‡ß™</option>
                        <option value="2024-05">‡¶Æ‡ßá ‡ß®‡ß¶‡ß®‡ß™</option>
                        <option value="2024-06">‡¶ú‡ßÅ‡¶® ‡ß®‡ß¶‡ß®‡ß™</option>
                        <option value="2024-07">‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á ‡ß®‡ß¶‡ß®‡ß™</option>
                        <option value="2024-08">‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü ‡ß®‡ß¶‡ß®‡ß™</option>
                        <option value="2024-09">‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞ ‡ß®‡ß¶‡ß®‡ß™</option>
                        <option value="2024-10">‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞ ‡ß®‡ß¶‡ß®‡ß™</option>
                        <option value="2024-11">‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞ ‡ß®‡ß¶‡ß®‡ß™</option>
                        <option value="2024-12">‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞ ‡ß®‡ß¶‡ß®‡ß™</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" id="cancelAddTenant" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors">
                        ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤
                    </button>
                    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                        ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Tenant Detail Modal -->
    <div id="tenantDetailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto fade-in">
            <div class="px-6 py-4 border-b border-gray-200 sticky top-0 bg-white">
                <div class="flex justify-between items-center">
                    <h3 id="tenantDetailTitle" class="text-lg font-semibold text-gray-900">‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</h3>
                    <button id="closeTenantDetail" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div id="tenantInfo" class="mb-6">
                    <!-- Tenant info will be loaded here -->
                </div>
                
                <!-- Monthly Payment Status -->
                <div class="bg-gray-50 rounded-lg p-4 mb-6">
                    <h4 class="text-md font-semibold text-gray-900 mb-4">‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</h4>
                    <div id="monthlyPaymentStatus" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2">
                        <!-- Monthly status will be loaded here -->
                    </div>
                </div>
                
                <!-- Add Payment Form -->
                <div class="bg-gray-50 rounded-lg p-4 mb-6">
                    <h4 class="text-md font-semibold text-gray-900 mb-4">üí∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
                    
                    <!-- Quick Payment Buttons -->
                    <div class="mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                        <h5 class="text-sm font-semibold text-blue-900 mb-2">‚ö° ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h5>
                        <div class="flex flex-wrap gap-2">
                            <button type="button" onclick="quickPayment('current')" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors">
                                ‡¶ö‡¶≤‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏ (‡ß≥<span id="currentMonthRent">0</span>)
                            </button>
                            <button type="button" onclick="quickPayment('previous')" class="px-3 py-1 bg-orange-600 text-white rounded text-sm hover:bg-orange-700 transition-colors">
                                ‡¶ó‡¶§ ‡¶Æ‡¶æ‡¶∏ (‡ß≥<span id="previousMonthRent">0</span>)
                            </button>
                            <button type="button" onclick="quickPayment('full')" class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700 transition-colors">
                                ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶≠‡¶æ‡¶°‡¶º‡¶æ (‡ß≥<span id="fullRent">0</span>)
                            </button>
                        </div>
                        <p class="text-xs text-blue-700 mt-2">üí° ‡¶ü‡¶ø‡¶™‡¶∏: ‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶ì ‡¶Æ‡¶æ‡¶∏ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶π‡¶¨‡ßá</p>
                    </div>

                    <form id="addPaymentForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">üíµ ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≥)</label>
                                <input type="number" id="paymentAmount" required min="0" step="0.01" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 5000" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                                <p class="text-xs text-gray-500 mt-1">‡¶Ü‡¶Ç‡¶∂‡¶ø‡¶ï ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶ì ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">üìÖ ‡¶ï‡ßã‡¶® ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø</label>
                                <select id="paymentMonth" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                </select>
                                <p class="text-xs text-gray-500 mt-1">‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">üóìÔ∏è ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                                <input type="date" id="paymentDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">üìù ‡¶®‡ßã‡¶ü (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
                                <input type="text" id="paymentNote" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶Ü‡¶Ç‡¶∂‡¶ø‡¶ï ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                        </div>

                        <!-- Payment Status Preview -->
                        <div id="paymentPreview" class="hidden bg-white border border-gray-200 rounded-lg p-3">
                            <h6 class="text-sm font-semibold text-gray-900 mb-2">üìä ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â</h6>
                            <div id="paymentPreviewContent" class="text-sm text-gray-600">
                                <!-- Preview content will be shown here -->
                            </div>
                        </div>
                        
                        <div class="flex justify-end">
                            <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors font-semibold">
                                ‚úÖ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Payment History -->
                <div>
                    <h4 class="text-md font-semibold text-gray-900 mb-4">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h4>
                    <div id="paymentHistory" class="space-y-3">
                        <!-- Payment history will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration - GitHub Pages ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶™‡ßç‡¶ü‡¶ø‡¶Æ‡¶æ‡¶á‡¶ú‡¶°
        const firebaseConfig = {
            // üî• Firebase Console ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ config ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶æ‡¶®
            // Console ‚Üí Project Settings ‚Üí General ‚Üí Your apps ‚Üí Web app ‚Üí Config
            
            // ‚ö†Ô∏è ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡ßÅ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Firebase Console ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßá ‡¶¨‡¶∏‡¶æ‡¶®:
            apiKey: "AIzaSyC_your_actual_api_key_here",
            authDomain: "your-project-id.firebaseapp.com", 
            projectId: "your-project-id",
            storageBucket: "your-project-id.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef123456"
            
            // üìù ‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£: ‡¶Ø‡¶¶‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü ID ‡¶π‡¶Ø‡¶º "basha-vara-management-12345" ‡¶§‡¶æ‡¶π‡¶≤‡ßá:
            // apiKey: "AIzaSyBdVla0_example_key_here",
            // authDomain: "basha-vara-management-12345.firebaseapp.com",
            // projectId: "basha-vara-management-12345",
            // storageBucket: "basha-vara-management-12345.appspot.com",
            // messagingSenderId: "987654321098",
            // appId: "1:987654321098:web:example123456"
        };

        // üìù ‡¶®‡ßã‡¶ü: Firebase ‡¶õ‡¶æ‡¶°‡¶º‡¶æ‡¶á ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡¶∞! ‡¶°‡ßá‡¶ü‡¶æ localStorage ‡¶è ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶π‡¶¨‡ßá
        // Production ‡¶è Firebase ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶â‡¶™‡¶∞‡ßá‡¶∞ config ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®

        // Initialize Firebase (Demo mode - using localStorage for persistence)
        let db;
        let isFirebaseConnected = false;

        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            isFirebaseConnected = true;
            console.log('Firebase connected successfully');
        } catch (error) {
            console.log('Firebase not configured, using demo mode with localStorage');
            isFirebaseConnected = false;
        }

        // Demo data storage with sample tenants
        let demoTenants = JSON.parse(localStorage.getItem('demoTenants') || JSON.stringify([
            {
                id: "1",
                name: "‡¶∞‡¶æ‡¶ú‡¶Æ‡¶ø‡¶∏‡ßç‡¶§‡ßç‡¶∞‡¶ø ‡¶∏‡¶æ‡¶π‡ßá‡¶¨",
                phone: "‡ß¶‡ßß‡ß≠‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ",
                roomNumber: "‡ßß‡ß¶‡ßß-‡ßß‡ß¶‡ß®",
                monthlyRent: 2200,
                advancePaid: 1500,
                startMonth: "2024-06",
                paymentHistory: [
                    {
                        amountPaid: 2000,
                        month: "2024-08",
                        date: "2024-08-15",
                        note: "‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü",
                        timestamp: "2024-08-15T10:00:00.000Z"
                    }
                ],
                createdAt: "2024-06-01T10:00:00.000Z"
            },
            {
                id: "2", 
                name: "‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶∏‡¶æ‡¶π‡ßá‡¶¨",
                phone: "‡ß¶‡ßß‡ßÆ‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ",
                roomNumber: "‡ß®‡ß¶‡ßß",
                monthlyRent: 1500,
                advancePaid: 3000,
                startMonth: "2024-06",
                paymentHistory: [],
                createdAt: "2024-06-01T11:00:00.000Z"
            }
        ]));
        let currentTenant = null;

        // Month names in Bengali
        const monthNames = {
            '01': '‡¶ú‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø', '02': '‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø', '03': '‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö', '04': '‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤',
            '05': '‡¶Æ‡ßá', '06': '‡¶ú‡ßÅ‡¶®', '07': '‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á', '08': '‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü',
            '09': '‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞', '10': '‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞', '11': '‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞', '12': '‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞'
        };

        // DOM Elements
        const addTenantBtn = document.getElementById('addTenantBtn');
        const addTenantModal = document.getElementById('addTenantModal');
        const addTenantForm = document.getElementById('addTenantForm');
        const cancelAddTenant = document.getElementById('cancelAddTenant');
        const tenantDetailModal = document.getElementById('tenantDetailModal');
        const closeTenantDetail = document.getElementById('closeTenantDetail');
        const addPaymentForm = document.getElementById('addPaymentForm');
        const tenantsContainer = document.getElementById('tenantsContainer');
        const monthFilter = document.getElementById('monthFilter');
        const outstandingFilter = document.getElementById('outstandingFilter');
        const refreshOutstanding = document.getElementById('refreshOutstanding');

        // PWA Install functionality
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.classList.remove('hidden');
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    showNotification('‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶≤ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
                }
                deferredPrompt = null;
                installBtn.classList.add('hidden');
            }
        });

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default for payment date
            const paymentDateInput = document.getElementById('paymentDate');
            if (paymentDateInput) {
                paymentDateInput.valueAsDate = new Date();
            }
            
            // Load all data
            loadTenants();
            updateDashboardStats();
            populateMonthFilters();
            updateOutstandingList();
            
            console.log('App initialized with demo data:', demoTenants);
            
            // Enhanced Service Worker for PWA
            if ('serviceWorker' in navigator) {
                const swCode = `
                    const CACHE_NAME = 'basha-vara-v1';
                    const urlsToCache = [
                        '/',
                        'https://cdn.tailwindcss.com',
                        'https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js',
                        'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js'
                    ];

                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });

                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request);
                                })
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(() => {
                        console.log('Service Worker registered successfully');
                        showNotification('‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§!', 'success');
                    })
                    .catch(err => console.log('Service Worker registration failed:', err));
            }

            // Network status monitoring
            function updateOnlineStatus() {
                const offlineIndicator = document.getElementById('offlineIndicator');
                if (navigator.onLine) {
                    offlineIndicator.classList.remove('show');
                } else {
                    offlineIndicator.classList.add('show');
                }
            }

            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            updateOnlineStatus();
        });

        // Event Listeners
        addTenantBtn.addEventListener('click', () => {
            addTenantModal.classList.remove('hidden');
            addTenantModal.classList.add('flex');
        });

        cancelAddTenant.addEventListener('click', closeAddTenantModal);
        closeTenantDetail.addEventListener('click', closeTenantDetailModal);
        addTenantForm.addEventListener('submit', handleAddTenant);
        addPaymentForm.addEventListener('submit', handleAddPayment);
        monthFilter.addEventListener('change', updateMonthlyStatus);
        outstandingFilter.addEventListener('change', updateOutstandingList);
        refreshOutstanding.addEventListener('click', updateOutstandingList);

        // Close modals when clicking outside
        addTenantModal.addEventListener('click', (e) => {
            if (e.target === addTenantModal) closeAddTenantModal();
        });

        tenantDetailModal.addEventListener('click', (e) => {
            if (e.target === tenantDetailModal) closeTenantDetailModal();
        });

        function populateMonthFilters() {
            const currentYear = new Date().getFullYear();
            const months = [];
            
            for (let year = currentYear - 1; year <= currentYear + 1; year++) {
                for (let month = 1; month <= 12; month++) {
                    const monthStr = month.toString().padStart(2, '0');
                    const value = `${year}-${monthStr}`;
                    const label = `${monthNames[monthStr]} ${year}`;
                    months.push({ value, label });
                }
            }

            // Populate month filter
            monthFilter.innerHTML = '<option value="">‡¶∏‡¶¨ ‡¶Æ‡¶æ‡¶∏</option>' + 
                months.map(m => `<option value="${m.value}">${m.label}</option>`).join('');

            // Set current month as default
            const currentMonth = new Date().toISOString().slice(0, 7);
            monthFilter.value = currentMonth;
        }

        function closeAddTenantModal() {
            addTenantModal.classList.add('hidden');
            addTenantModal.classList.remove('flex');
            addTenantForm.reset();
        }

        function closeTenantDetailModal() {
            tenantDetailModal.classList.add('hidden');
            tenantDetailModal.classList.remove('flex');
            currentTenant = null;
        }

        async function handleAddTenant(e) {
            e.preventDefault();
            
            const tenantData = {
                name: document.getElementById('tenantName').value,
                phone: document.getElementById('tenantPhone').value,
                roomNumber: document.getElementById('tenantRoom').value,
                monthlyRent: parseFloat(document.getElementById('tenantRent').value),
                advancePaid: parseFloat(document.getElementById('tenantAdvance').value) || 0,
                startMonth: document.getElementById('tenantStartMonth').value,
                paymentHistory: [],
                createdAt: new Date().toISOString()
            };

            try {
                if (isFirebaseConnected) {
                    await db.collection('tenants').add(tenantData);
                } else {
                    tenantData.id = Date.now().toString();
                    demoTenants.push(tenantData);
                    localStorage.setItem('demoTenants', JSON.stringify(demoTenants));
                }
                
                closeAddTenantModal();
                loadTenants();
                updateDashboardStats();
                updateMonthlyStatus();
                updateOutstandingList();
                showNotification('‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
            } catch (error) {
                console.error('Error adding tenant:', error);
                showNotification('‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', 'error');
            }
        }

        async function loadTenants() {
            try {
                let tenants = [];
                
                if (isFirebaseConnected) {
                    const snapshot = await db.collection('tenants').get();
                    tenants = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                } else {
                    // Ensure demo data is properly loaded
                    tenants = demoTenants || [];
                    console.log('Loading demo tenants:', tenants);
                }

                displayTenants(tenants);
            } catch (error) {
                console.error('Error loading tenants:', error);
                // Fallback to demo data
                displayTenants(demoTenants || []);
                showNotification('‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ‡¶¶‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', 'error');
            }
        }

        function displayTenants(tenants) {
            console.log('Displaying tenants:', tenants);
            
            if (!tenants || tenants.length === 0) {
                tenantsContainer.innerHTML = `
                    <div class="p-8 text-center text-gray-500">
                        <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        <p class="text-lg font-medium">‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ ‡¶®‡ßá‡¶á</p>
                        <p class="text-sm">"‡¶®‡¶§‡ßÅ‡¶® ‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ" ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    </div>
                `;
                return;
            }

            tenantsContainer.innerHTML = tenants.map(tenant => {
                const currentMonth = new Date().toISOString().slice(0, 7);
                const monthlyStatus = getMonthlyPaymentStatus(tenant, currentMonth);
                const totalDue = calculateTotalDue(tenant);
                
                let statusBadge = '';
                if (monthlyStatus.status === 'paid') {
                    statusBadge = '<span class="px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§</span>';
                } else if (monthlyStatus.status === 'partial') {
                    statusBadge = '<span class="px-2 py-1 text-xs font-semibold bg-yellow-100 text-yellow-800 rounded-full">‡¶Ü‡¶Ç‡¶∂‡¶ø‡¶ï</span>';
                } else {
                    statusBadge = '<span class="px-2 py-1 text-xs font-semibold bg-red-100 text-red-800 rounded-full">‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ</span>';
                }

                const dueClass = totalDue > 0 ? 'balance-negative' : totalDue < 0 ? 'balance-positive' : 'balance-zero';
                const dueText = totalDue > 0 ? `‡ß≥${totalDue.toFixed(0)} ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ` : 
                               totalDue < 0 ? `‡ß≥${Math.abs(totalDue).toFixed(0)} ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ` : '‡¶∏‡¶Æ‡¶æ‡¶®';

                return `
                    <div class="p-6 hover:bg-gray-50 cursor-pointer transition-colors" onclick="openTenantDetail('${tenant.id}')">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div class="bg-indigo-100 p-3 rounded-full">
                                    <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900">${tenant.name}</h3>
                                    <p class="text-sm text-gray-600">‡¶∞‡ßÅ‡¶Æ ${tenant.roomNumber} ‚Ä¢ ‡ß≥${tenant.monthlyRent}/‡¶Æ‡¶æ‡¶∏</p>
                                    <p class="text-sm text-gray-500">${tenant.phone}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="mb-2">${statusBadge}</div>
                                <p class="text-sm text-gray-500">‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</p>
                                <p class="text-lg font-bold ${dueClass}">${dueText}</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getMonthlyPaymentStatus(tenant, month) {
            if (!tenant.startMonth || month < tenant.startMonth) {
                return { status: 'not-applicable', paid: 0, due: 0 };
            }

            const monthPayments = tenant.paymentHistory?.filter(p => p.month === month) || [];
            const totalPaid = monthPayments.reduce((sum, p) => sum + p.amountPaid, 0);
            const due = tenant.monthlyRent - totalPaid;

            if (due <= 0) return { status: 'paid', paid: totalPaid, due: 0 };
            if (totalPaid > 0) return { status: 'partial', paid: totalPaid, due };
            return { status: 'unpaid', paid: 0, due: tenant.monthlyRent };
        }

        function calculateTotalDue(tenant) {
            if (!tenant.startMonth) return 0;

            const currentMonth = new Date().toISOString().slice(0, 7);
            let totalDue = -tenant.advancePaid; // Start with advance as credit
            
            // Calculate from start month to current month
            const startDate = new Date(tenant.startMonth + '-01');
            const currentDate = new Date(currentMonth + '-01');
            
            let checkDate = new Date(startDate);
            while (checkDate <= currentDate) {
                const monthStr = checkDate.toISOString().slice(0, 7);
                totalDue += tenant.monthlyRent; // Add monthly rent
                
                // Subtract payments for this month
                const monthPayments = tenant.paymentHistory?.filter(p => p.month === monthStr) || [];
                const monthlyPaid = monthPayments.reduce((sum, p) => sum + p.amountPaid, 0);
                totalDue -= monthlyPaid;
                
                checkDate.setMonth(checkDate.getMonth() + 1);
            }
            
            return totalDue;
        }

        async function updateMonthlyStatus() {
            const selectedMonth = monthFilter.value;
            if (!selectedMonth) {
                // Set current month as default
                const currentMonth = new Date().toISOString().slice(0, 7);
                monthFilter.value = currentMonth;
                return updateMonthlyStatus();
            }

            try {
                let tenants = [];
                
                if (isFirebaseConnected) {
                    const snapshot = await db.collection('tenants').get();
                    tenants = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                } else {
                    tenants = demoTenants;
                }

                const monthlyStatusContainer = document.getElementById('monthlyStatus');
                const [year, month] = selectedMonth.split('-');
                const monthName = `${monthNames[month]} ${year}`;

                if (tenants.length === 0) {
                    monthlyStatusContainer.innerHTML = `
                        <div class="col-span-full text-center text-gray-500 py-8">
                            <p>‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ ‡¶®‡ßá‡¶á</p>
                        </div>
                    `;
                    return;
                }

                monthlyStatusContainer.innerHTML = tenants.map(tenant => {
                    const status = getMonthlyPaymentStatus(tenant, selectedMonth);
                    
                    let statusClass = '';
                    let statusText = '';
                    let amountText = '';

                    if (status.status === 'not-applicable') {
                        statusClass = 'bg-gray-100 text-gray-600';
                        statusText = '‡¶™‡ßç‡¶∞‡¶Ø‡ßã‡¶ú‡ßç‡¶Ø ‡¶®‡¶Ø‡¶º';
                        amountText = '';
                    } else if (status.status === 'paid') {
                        statusClass = 'month-paid';
                        statusText = '‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§';
                        amountText = `‡ß≥${status.paid}`;
                    } else if (status.status === 'partial') {
                        statusClass = 'month-partial';
                        statusText = '‡¶Ü‡¶Ç‡¶∂‡¶ø‡¶ï';
                        amountText = `‡ß≥${status.paid}/‡ß≥${tenant.monthlyRent}`;
                    } else {
                        statusClass = 'month-unpaid';
                        statusText = '‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ';
                        amountText = `‡ß≥${status.due}`;
                    }

                    return `
                        <div class="p-4 rounded-lg border ${statusClass}" onclick="openTenantDetail('${tenant.id}')">
                            <div class="cursor-pointer">
                                <h4 class="font-semibold">${tenant.name}</h4>
                                <p class="text-sm opacity-75">‡¶∞‡ßÅ‡¶Æ ${tenant.roomNumber}</p>
                                <p class="text-sm font-medium mt-2">${statusText}</p>
                                ${amountText ? `<p class="text-sm">${amountText}</p>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error updating monthly status:', error);
            }
        }

        async function openTenantDetail(tenantId) {
            try {
                let tenant;
                
                if (isFirebaseConnected) {
                    const doc = await db.collection('tenants').doc(tenantId).get();
                    tenant = { id: doc.id, ...doc.data() };
                } else {
                    tenant = demoTenants.find(t => t.id === tenantId);
                }

                if (!tenant) return;

                currentTenant = tenant;
                displayTenantDetail(tenant);
                populatePaymentMonths(tenant);
                tenantDetailModal.classList.remove('hidden');
                tenantDetailModal.classList.add('flex');
            } catch (error) {
                console.error('Error loading tenant details:', error);
                showNotification('‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', 'error');
            }
        }

        function populatePaymentMonths(tenant) {
            const paymentMonthSelect = document.getElementById('paymentMonth');
            const currentYear = new Date().getFullYear();
            const months = [];
            
            // Generate months from tenant start month to next year
            if (tenant.startMonth) {
                const startDate = new Date(tenant.startMonth + '-01');
                const endDate = new Date(currentYear + 1, 11, 31); // End of next year
                
                let checkDate = new Date(startDate);
                while (checkDate <= endDate) {
                    const monthStr = checkDate.toISOString().slice(0, 7);
                    const [year, month] = monthStr.split('-');
                    const label = `${monthNames[month]} ${year}`;
                    months.push({ value: monthStr, label });
                    checkDate.setMonth(checkDate.getMonth() + 1);
                }
            }

            paymentMonthSelect.innerHTML = '<option value="">‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>' + 
                months.map(m => `<option value="${m.value}">${m.label}</option>`).join('');
        }

        function displayTenantDetail(tenant) {
            const totalDue = calculateTotalDue(tenant);
            const dueClass = totalDue > 0 ? 'balance-negative' : totalDue < 0 ? 'balance-positive' : 'balance-zero';
            const dueText = totalDue > 0 ? `‡ß≥${totalDue.toFixed(0)} ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ` : 
                           totalDue < 0 ? `‡ß≥${Math.abs(totalDue).toFixed(0)} ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ` : '‡¶∏‡¶Æ‡¶æ‡¶®';

            document.getElementById('tenantDetailTitle').textContent = tenant.name;
            
            document.getElementById('tenantInfo').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-900 mb-2">‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø</h4>
                        <p class="text-sm text-gray-600">‡¶´‡ßã‡¶®: ${tenant.phone}</p>
                        <p class="text-sm text-gray-600">‡¶∞‡ßÅ‡¶Æ: ${tenant.roomNumber}</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-900 mb-2">‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</h4>
                        <p class="text-sm text-gray-600">‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶≠‡¶æ‡¶°‡¶º‡¶æ: ‡ß≥${tenant.monthlyRent}</p>
                        <p class="text-sm text-gray-600">‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ: ‡ß≥${tenant.advancePaid || 0}</p>
                        <p class="text-sm text-gray-600">‡¶∂‡ßÅ‡¶∞‡ßÅ: ${tenant.startMonth ? getMonthName(tenant.startMonth) : '‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶ø‡¶§ ‡¶®‡¶Ø‡¶º'}</p>
                    </div>
                </div>
                <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
                    <div class="flex justify-between items-center">
                        <h4 class="font-semibold text-gray-900">‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</h4>
                        <p class="text-2xl font-bold ${dueClass}">${dueText}</p>
                    </div>
                </div>
            `;

            displayMonthlyPaymentStatus(tenant);
            displayPaymentHistory(tenant.paymentHistory || []);
            updateQuickPaymentButtons(tenant);
            
            // Add event listeners for payment preview
            setTimeout(() => {
                const paymentAmountInput = document.getElementById('paymentAmount');
                const paymentMonthSelect = document.getElementById('paymentMonth');
                
                if (paymentAmountInput && paymentMonthSelect) {
                    paymentAmountInput.addEventListener('input', updatePaymentPreview);
                    paymentMonthSelect.addEventListener('change', updatePaymentPreview);
                }
            }, 100);
        }

        function displayMonthlyPaymentStatus(tenant) {
            if (!tenant.startMonth) {
                document.getElementById('monthlyPaymentStatus').innerHTML = `
                    <div class="col-span-full text-center text-gray-500 py-4">
                        <p>‡¶≠‡¶æ‡¶°‡¶º‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶ø‡¶§ ‡¶®‡¶Ø‡¶º</p>
                    </div>
                `;
                return;
            }

            const currentYear = new Date().getFullYear();
            const months = [];
            
            // Generate last 12 months and next 6 months
            const startDate = new Date(tenant.startMonth + '-01');
            const endDate = new Date(currentYear, new Date().getMonth() + 6, 1);
            
            let checkDate = new Date(startDate);
            while (checkDate <= endDate) {
                const monthStr = checkDate.toISOString().slice(0, 7);
                months.push(monthStr);
                checkDate.setMonth(checkDate.getMonth() + 1);
            }

            document.getElementById('monthlyPaymentStatus').innerHTML = months.map(month => {
                const status = getMonthlyPaymentStatus(tenant, month);
                const [year, monthNum] = month.split('-');
                const monthName = monthNames[monthNum];
                
                let statusClass = '';
                let statusIcon = '';

                if (status.status === 'not-applicable') {
                    statusClass = 'bg-gray-100 text-gray-600';
                    statusIcon = '‚Äî';
                } else if (status.status === 'paid') {
                    statusClass = 'month-paid';
                    statusIcon = '‚úì';
                } else if (status.status === 'partial') {
                    statusClass = 'month-partial';
                    statusIcon = '¬Ω';
                } else {
                    statusClass = 'month-unpaid';
                    statusIcon = '‚úó';
                }

                return `
                    <div class="p-2 rounded text-center text-xs ${statusClass}">
                        <div class="font-semibold">${monthName}</div>
                        <div class="text-lg">${statusIcon}</div>
                        <div>${year}</div>
                    </div>
                `;
            }).join('');
        }

        function displayPaymentHistory(payments) {
            if (payments.length === 0) {
                document.getElementById('paymentHistory').innerHTML = `
                    <div class="text-center text-gray-500 py-4">
                        <p>‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶®‡ßá‡¶á</p>
                    </div>
                `;
                return;
            }

            const sortedPayments = payments.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            document.getElementById('paymentHistory').innerHTML = sortedPayments.map(payment => {
                const monthName = getMonthName(payment.month);
                
                return `
                    <div class="bg-white border border-gray-200 rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-semibold text-gray-900">‡ß≥${payment.amountPaid.toFixed(0)}</p>
                                <p class="text-sm text-gray-600">${monthName}</p>
                                <p class="text-xs text-gray-500">${new Date(payment.date).toLocaleDateString('bn-BD')}</p>
                                ${payment.note ? `<p class="text-xs text-blue-600 mt-1">üìù ${payment.note}</p>` : ''}
                            </div>
                            <div class="text-right">
                                <span class="px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">
                                    ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Quick Payment Functions
        function quickPayment(type) {
            if (!currentTenant) return;

            const currentMonth = new Date().toISOString().slice(0, 7);
            const previousMonth = new Date();
            previousMonth.setMonth(previousMonth.getMonth() - 1);
            const prevMonthStr = previousMonth.toISOString().slice(0, 7);

            const paymentAmountInput = document.getElementById('paymentAmount');
            const paymentMonthSelect = document.getElementById('paymentMonth');
            const paymentNote = document.getElementById('paymentNote');

            switch(type) {
                case 'current':
                    paymentAmountInput.value = currentTenant.monthlyRent;
                    paymentMonthSelect.value = currentMonth;
                    paymentNote.value = '‡¶ö‡¶≤‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶≠‡¶æ‡¶°‡¶º‡¶æ';
                    break;
                case 'previous':
                    paymentAmountInput.value = currentTenant.monthlyRent;
                    paymentMonthSelect.value = prevMonthStr;
                    paymentNote.value = '‡¶ó‡¶§ ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶≠‡¶æ‡¶°‡¶º‡¶æ';
                    break;
                case 'full':
                    const totalDue = calculateTotalDue(currentTenant);
                    if (totalDue > 0) {
                        paymentAmountInput.value = totalDue;
                        paymentNote.value = '‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß';
                        // Find the oldest unpaid month
                        const oldestUnpaidMonth = findOldestUnpaidMonth(currentTenant);
                        if (oldestUnpaidMonth) {
                            paymentMonthSelect.value = oldestUnpaidMonth;
                        }
                    }
                    break;
            }

            // Show payment preview
            updatePaymentPreview();
        }

        function findOldestUnpaidMonth(tenant) {
            if (!tenant.startMonth) return null;

            const currentMonth = new Date().toISOString().slice(0, 7);
            const startDate = new Date(tenant.startMonth + '-01');
            const currentDate = new Date(currentMonth + '-01');
            
            let checkDate = new Date(startDate);
            while (checkDate <= currentDate) {
                const monthStr = checkDate.toISOString().slice(0, 7);
                const status = getMonthlyPaymentStatus(tenant, monthStr);
                
                if (status.status === 'unpaid' || status.status === 'partial') {
                    return monthStr;
                }
                
                checkDate.setMonth(checkDate.getMonth() + 1);
            }
            
            return null;
        }

        function updatePaymentPreview() {
            if (!currentTenant) return;

            const amount = parseFloat(document.getElementById('paymentAmount').value) || 0;
            const month = document.getElementById('paymentMonth').value;
            
            if (amount <= 0 || !month) {
                document.getElementById('paymentPreview').classList.add('hidden');
                return;
            }

            const monthStatus = getMonthlyPaymentStatus(currentTenant, month);
            const monthName = getMonthName(month);
            const monthlyRent = currentTenant.monthlyRent;
            
            let previewContent = '';
            
            if (monthStatus.status === 'not-applicable') {
                previewContent = `
                    <div class="text-orange-600">
                        ‚ö†Ô∏è ${monthName} ‡¶Æ‡¶æ‡¶∏‡ßá ‡¶≠‡¶æ‡¶°‡¶º‡¶æ ‡¶™‡ßç‡¶∞‡¶Ø‡ßã‡¶ú‡ßç‡¶Ø ‡¶®‡¶Ø‡¶º (‡¶≠‡¶æ‡¶°‡¶º‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶Ü‡¶ó‡ßá)
                    </div>
                `;
            } else {
                const currentPaid = monthStatus.paid;
                const totalAfterPayment = currentPaid + amount;
                const remaining = monthlyRent - totalAfterPayment;
                
                if (remaining <= 0) {
                    const excess = Math.abs(remaining);
                    previewContent = `
                        <div class="text-green-600">
                            ‚úÖ ${monthName} ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶≠‡¶æ‡¶°‡¶º‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶π‡¶¨‡ßá
                            <br>‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§: ‡ß≥${currentPaid}
                            <br>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü: ‡ß≥${amount}
                            <br>‡¶Æ‡ßã‡¶ü: ‡ß≥${totalAfterPayment}
                            ${excess > 0 ? `<br><span class="text-blue-600">‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§: ‡ß≥${excess} (‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶Æ‡¶æ‡¶∏‡ßá ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶ó‡¶£‡ßç‡¶Ø ‡¶π‡¶¨‡ßá)</span>` : ''}
                        </div>
                    `;
                } else {
                    previewContent = `
                        <div class="text-yellow-600">
                            ‚ö° ${monthName} ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶Ü‡¶Ç‡¶∂‡¶ø‡¶ï ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü
                            <br>‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§: ‡ß≥${currentPaid}
                            <br>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü: ‡ß≥${amount}
                            <br>‡¶Æ‡ßã‡¶ü ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§: ‡ß≥${totalAfterPayment}
                            <br>‡¶¨‡¶æ‡¶ï‡¶ø: ‡ß≥${remaining}
                        </div>
                    `;
                }
            }
            
            document.getElementById('paymentPreviewContent').innerHTML = previewContent;
            document.getElementById('paymentPreview').classList.remove('hidden');
        }

        // Update quick payment button amounts when tenant is loaded
        function updateQuickPaymentButtons(tenant) {
            if (!tenant) return;

            document.getElementById('currentMonthRent').textContent = tenant.monthlyRent;
            document.getElementById('previousMonthRent').textContent = tenant.monthlyRent;
            
            const totalDue = calculateTotalDue(tenant);
            document.getElementById('fullRent').textContent = totalDue > 0 ? totalDue.toFixed(0) : tenant.monthlyRent;
        }

        function getMonthName(monthStr) {
            if (!monthStr) return '';
            const [year, month] = monthStr.split('-');
            return `${monthNames[month]} ${year}`;
        }

        async function handleAddPayment(e) {
            e.preventDefault();
            
            if (!currentTenant) return;

            const amount = parseFloat(document.getElementById('paymentAmount').value);
            const month = document.getElementById('paymentMonth').value;
            const date = document.getElementById('paymentDate').value;
            const note = document.getElementById('paymentNote').value.trim();
            
            const payment = {
                amountPaid: amount,
                month: month,
                date: date,
                note: note || null,
                timestamp: new Date().toISOString()
            };

            try {
                if (isFirebaseConnected) {
                    await db.collection('tenants').doc(currentTenant.id).update({
                        paymentHistory: firebase.firestore.FieldValue.arrayUnion(payment)
                    });
                } else {
                    const tenantIndex = demoTenants.findIndex(t => t.id === currentTenant.id);
                    if (tenantIndex !== -1) {
                        if (!demoTenants[tenantIndex].paymentHistory) {
                            demoTenants[tenantIndex].paymentHistory = [];
                        }
                        demoTenants[tenantIndex].paymentHistory.push(payment);
                        localStorage.setItem('demoTenants', JSON.stringify(demoTenants));
                    }
                }

                // Update current tenant data
                if (!currentTenant.paymentHistory) currentTenant.paymentHistory = [];
                currentTenant.paymentHistory.push(payment);

                // Check if this payment completes the month
                const monthStatus = getMonthlyPaymentStatus(currentTenant, month);
                const monthName = getMonthName(month);
                let successMessage = '‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!';
                
                if (monthStatus.status === 'paid') {
                    successMessage = `üéâ ${monthName} ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶≠‡¶æ‡¶°‡¶º‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`;
                } else if (monthStatus.status === 'partial') {
                    const remaining = currentTenant.monthlyRent - monthStatus.paid;
                    successMessage = `‚úÖ ‡¶Ü‡¶Ç‡¶∂‡¶ø‡¶ï ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¨‡¶æ‡¶ï‡¶ø: ‡ß≥${remaining}`;
                }

                // Refresh displays
                displayTenantDetail(currentTenant);
                loadTenants();
                updateDashboardStats();
                updateMonthlyStatus();
                updateOutstandingList();
                
                // Reset form
                addPaymentForm.reset();
                document.getElementById('paymentDate').valueAsDate = new Date();
                document.getElementById('paymentPreview').classList.add('hidden');
                
                showNotification(successMessage, 'success');
            } catch (error) {
                console.error('Error adding payment:', error);
                showNotification('‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', 'error');
            }
        }

        async function updateDashboardStats() {
            try {
                let tenants = [];
                
                if (isFirebaseConnected) {
                    const snapshot = await db.collection('tenants').get();
                    tenants = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                } else {
                    tenants = demoTenants;
                }

                const totalTenants = tenants.length;
                const monthlyRevenue = tenants.reduce((sum, tenant) => sum + (tenant.monthlyRent || 0), 0);
                const outstandingAmount = tenants.reduce((sum, tenant) => {
                    const due = calculateTotalDue(tenant);
                    return sum + (due > 0 ? due : 0);
                }, 0);

                // Count tenants who paid this month
                const currentMonth = new Date().toISOString().slice(0, 7);
                const currentMonthPaid = tenants.filter(tenant => {
                    const status = getMonthlyPaymentStatus(tenant, currentMonth);
                    return status.status === 'paid';
                }).length;

                document.getElementById('totalTenants').textContent = totalTenants;
                document.getElementById('monthlyRevenue').textContent = `‡ß≥${monthlyRevenue.toFixed(0)}`;
                document.getElementById('outstandingAmount').textContent = `‡ß≥${outstandingAmount.toFixed(0)}`;
                document.getElementById('currentMonthPaid').textContent = `${currentMonthPaid}/${totalTenants}`;

                // Update monthly status
                updateMonthlyStatus();
            } catch (error) {
                console.error('Error updating dashboard stats:', error);
            }
        }

        async function updateOutstandingList() {
            try {
                let tenants = [];
                
                if (isFirebaseConnected) {
                    const snapshot = await db.collection('tenants').get();
                    tenants = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                } else {
                    tenants = demoTenants;
                }

                const filter = outstandingFilter.value;
                const outstandingContainer = document.getElementById('outstandingList');

                if (tenants.length === 0) {
                    outstandingContainer.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                            <p class="text-lg font-medium">‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ ‡¶®‡ßá‡¶á</p>
                        </div>
                    `;
                    return;
                }

                // Calculate outstanding for each tenant
                const tenantsWithOutstanding = tenants.map(tenant => {
                    const totalDue = calculateTotalDue(tenant);
                    return {
                        ...tenant,
                        totalDue: totalDue
                    };
                });

                // Filter based on selection
                let filteredTenants = tenantsWithOutstanding;
                if (filter === 'outstanding') {
                    filteredTenants = tenantsWithOutstanding.filter(t => t.totalDue > 0);
                } else if (filter === 'advance') {
                    filteredTenants = tenantsWithOutstanding.filter(t => t.totalDue < 0);
                }

                // Sort by outstanding amount (highest first)
                filteredTenants.sort((a, b) => b.totalDue - a.totalDue);

                if (filteredTenants.length === 0) {
                    let emptyMessage = '';
                    if (filter === 'outstanding') {
                        emptyMessage = 'üéâ ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶®‡ßá‡¶á! ‡¶∏‡¶¨‡¶æ‡¶á ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§';
                    } else if (filter === 'advance') {
                        emptyMessage = '‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§';
                    } else {
                        emptyMessage = '‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ ‡¶®‡ßá‡¶á‡•§';
                    }
                    
                    outstandingContainer.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <p class="text-lg">${emptyMessage}</p>
                        </div>
                    `;
                    return;
                }

                outstandingContainer.innerHTML = filteredTenants.map(tenant => {
                    const currentMonth = new Date().toISOString().slice(0, 7);
                    const monthlyStatus = getMonthlyPaymentStatus(tenant, currentMonth);
                    
                    let statusBadge = '';
                    let statusColor = '';
                    
                    if (tenant.totalDue > 0) {
                        statusBadge = `‡ß≥${tenant.totalDue.toFixed(0)} ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ`;
                        statusColor = 'bg-red-50 border-red-200 text-red-800';
                    } else if (tenant.totalDue < 0) {
                        statusBadge = `‡ß≥${Math.abs(tenant.totalDue).toFixed(0)} ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ`;
                        statusColor = 'bg-green-50 border-green-200 text-green-800';
                    } else {
                        statusBadge = '‡¶∏‡¶Æ‡¶æ‡¶®';
                        statusColor = 'bg-gray-50 border-gray-200 text-gray-800';
                    }

                    // Calculate months behind
                    let monthsBehind = 0;
                    if (tenant.totalDue > 0) {
                        monthsBehind = Math.ceil(tenant.totalDue / tenant.monthlyRent);
                    }

                    // Current month status
                    let currentMonthBadge = '';
                    if (monthlyStatus.status === 'paid') {
                        currentMonthBadge = '<span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏‡ßá ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§</span>';
                    } else if (monthlyStatus.status === 'partial') {
                        currentMonthBadge = '<span class="px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded-full">‡¶Ü‡¶Ç‡¶∂‡¶ø‡¶ï ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß</span>';
                    } else if (monthlyStatus.status === 'unpaid') {
                        currentMonthBadge = '<span class="px-2 py-1 text-xs bg-red-100 text-red-800 rounded-full">‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏‡ßá ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ</span>';
                    }

                    return `
                        <div class="border rounded-lg p-4 ${statusColor} cursor-pointer hover:shadow-md transition-shadow" onclick="openTenantDetail('${tenant.id}')">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <div class="bg-white p-2 rounded-full">
                                            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-lg">${tenant.name}</h4>
                                            <p class="text-sm opacity-75">‡¶∞‡ßÅ‡¶Æ ${tenant.roomNumber} ‚Ä¢ ‡ß≥${tenant.monthlyRent}/‡¶Æ‡¶æ‡¶∏</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex flex-wrap gap-2 mb-2">
                                        ${currentMonthBadge}
                                        ${monthsBehind > 0 ? `<span class="px-2 py-1 text-xs bg-red-100 text-red-800 rounded-full">${monthsBehind} ‡¶Æ‡¶æ‡¶∏ ‡¶™‡¶ø‡¶õ‡¶ø‡¶Ø‡¶º‡ßá</span>` : ''}
                                    </div>
                                    
                                    <div class="text-sm opacity-75">
                                        <p>üìû ${tenant.phone}</p>
                                        ${tenant.startMonth ? `<p>üìÖ ‡¶∂‡ßÅ‡¶∞‡ßÅ: ${getMonthName(tenant.startMonth)}</p>` : ''}
                                    </div>
                                </div>
                                
                                <div class="text-right">
                                    <div class="text-2xl font-bold mb-1">${statusBadge}</div>
                                    <button class="px-3 py-1 bg-white bg-opacity-50 rounded text-sm hover:bg-opacity-75 transition-colors">
                                        ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‚Üí
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                // Add summary at the top
                const totalOutstanding = filteredTenants.reduce((sum, t) => sum + (t.totalDue > 0 ? t.totalDue : 0), 0);
                const totalAdvance = filteredTenants.reduce((sum, t) => sum + (t.totalDue < 0 ? Math.abs(t.totalDue) : 0), 0);
                const outstandingCount = filteredTenants.filter(t => t.totalDue > 0).length;
                const advanceCount = filteredTenants.filter(t => t.totalDue < 0).length;

                if (filter === 'all' && (totalOutstanding > 0 || totalAdvance > 0)) {
                    const summaryHtml = `
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                            <h4 class="font-semibold text-blue-900 mb-2">üìä ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™</h4>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-red-600 font-semibold">‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ:</span> ‡ß≥${totalOutstanding.toFixed(0)}
                                    <br><span class="text-gray-600">(${outstandingCount} ‡¶ú‡¶® ‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ)</span>
                                </div>
                                <div>
                                    <span class="text-green-600 font-semibold">‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ:</span> ‡ß≥${totalAdvance.toFixed(0)}
                                    <br><span class="text-gray-600">(${advanceCount} ‡¶ú‡¶® ‡¶≠‡¶æ‡¶°‡¶º‡¶æ‡¶ü‡¶ø‡¶Ø‡¶º‡¶æ)</span>
                                </div>
                            </div>
                        </div>
                    `;
                    outstandingContainer.innerHTML = summaryHtml + outstandingContainer.innerHTML;
                }

            } catch (error) {
                console.error('Error updating outstanding list:', error);
                document.getElementById('outstandingList').innerHTML = `
                    <div class="text-center text-red-500 py-8">
                        <p>‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§</p>
                    </div>
                `;
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white font-medium fade-in ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Add demo notice and mobile app installation guide
        if (!isFirebaseConnected) {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(() => {
                    showNotification('‡¶°‡ßá‡¶Æ‡ßã ‡¶Æ‡ßã‡¶°: ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßÄ‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§‡•§ Firebase ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶ó‡¶æ‡¶á‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§', 'info');
                }, 1000);
                
                // Show mobile app installation guide
                setTimeout(() => {
                    const installGuide = document.createElement('div');
                    installGuide.className = 'fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:max-w-sm bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg shadow-lg p-4 z-50';
                    installGuide.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <h4 class="font-semibold text-lg">üì± ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
                            <button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-gray-200 text-xl">√ó</button>
                        </div>
                        <div class="text-sm space-y-2 mb-4">
                            <p><strong>Android:</strong></p>
                            <p>‚Ä¢ Chrome ‡¶è ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶® ‚Üí ‡¶Æ‡ßá‡¶®‡ßÅ (‚ãÆ) ‚Üí "Add to Home screen"</p>
                            <p><strong>iPhone:</strong></p>
                            <p>‚Ä¢ Safari ‡¶è ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶® ‚Üí Share (üì§) ‚Üí "Add to Home Screen"</p>
                            <p><strong>‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ:</strong> ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞, ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶ï‡¶æ‡¶ú, ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏</p>
                        </div>
                        <div class="border-t border-white border-opacity-30 pt-3 mt-3">
                            <h5 class="font-semibold mb-2">üîß Firebase ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï):</h5>
                            <div class="text-xs space-y-1">
                                <p>‡ßß. <a href="https://console.firebase.google.com" target="_blank" class="underline">Firebase Console</a> ‡¶è ‡¶Ø‡¶æ‡¶®</p>
                                <p>‡ß®. ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‚Üí Firestore Database ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                                <p>‡ß©. Web App ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßá Config ‡¶ï‡ßã‡¶° ‡¶¨‡¶∏‡¶æ‡¶®</p>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(installGuide);
                    
                    // Auto hide after 15 seconds
                    setTimeout(() => {
                        if (installGuide.parentNode) {
                            installGuide.remove();
                        }
                    }, 15000);
                }, 2000);
            });
        }

        // Add mobile-specific optimizations
        document.addEventListener('DOMContentLoaded', function() {
            // Prevent zoom on input focus (iOS)
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    if (window.innerWidth < 768) {
                        document.querySelector('meta[name=viewport]').setAttribute('content', 
                            'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
                    }
                });
                
                input.addEventListener('blur', function() {
                    if (window.innerWidth < 768) {
                        document.querySelector('meta[name=viewport]').setAttribute('content', 
                            'width=device-width, initial-scale=1.0');
                    }
                });
            });

            // Add touch feedback for buttons
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('touchstart', function() {
                    this.style.transform = 'scale(0.95)';
                });
                
                button.addEventListener('touchend', function() {
                    this.style.transform = 'scale(1)';
                });
            });

            // Detect if running as PWA
            if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone) {
                document.body.classList.add('pwa-mode');
                console.log('Running as PWA');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96b7c011f111a48e',t:'MTc1NDU3OTk0Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
